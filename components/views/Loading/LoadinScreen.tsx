"use client"
import gsap from "gsap";
import { Dispatch, SetStateAction, useEffect, useRef } from "react";

type LoadinScreenProps = {
    loadingAnimationFinished: boolean;
    setLoadingAnimationFinished: Dispatch<SetStateAction<boolean>>
}

export default function LoadinScreen({ loadingAnimationFinished, setLoadingAnimationFinished }: LoadinScreenProps) {
    const masterTimelineRef = useRef<GSAPTimeline>()

    useEffect(() => {
        const masterTimeline = gsap.timeline({
            onComplete: () => {
                setTimeout(() => {
                    setLoadingAnimationFinished(true)
                }, 1000);
            }
        });

        // Configuration initiale
        masterTimeline.set("#svg", { display: "block" });

        masterTimeline
            .fromTo("#txts-fe path",
                {
                    strokeDasharray: (i, target) => target.getTotalLength(),
                    strokeDashoffset: (i, target) => target.getTotalLength()
                },
                {
                    strokeDashoffset: 0,
                    duration: 2,
                    ease: "power2.inOut"
                })
            .to(".fe-offset", {
                attr: { dy: 6 },
                duration: 0.5,
                ease: "power2.out"
            }, "+1")
            .fromTo("#txts-fe", {
                x: 6,
                y: 6
            }, {
                x: 0,
                y: 0,
                duration: 0.8,
                ease: "elastic.out(1, 0.5)"
            }, "<")
            .fromTo("#txts-anarana path",
                {
                    x: 6,
                    y: 6
                },
                {
                    x: 0,
                    y: 0,
                    ease: "elastic.out(1, 0.5)",
                    stagger: {
                        amount: 0.1
                    }
                },
                "<")
                .to("#background", {
                    background: "#2BB5FF",
                    duration: 1.5
                }, "+1");


        // Nettoyage
        return () => {
            masterTimeline.kill();
        };
    }, [setLoadingAnimationFinished]);

    return <main id="background" className="flex items-center justify-center bg-[#0077B6] w-full h-[100dvh]">
        <svg id="svg" className="hidden w-[631px] h-[97px] mx-10 md:w-[651px] md:h-[117px]" viewBox="0 0 651 117" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g id="txts-anarana" filter="url(#filter0_d_13_2)">
                <path d="M611.522 102.429C604.083 102.429 598.36 100.76 594.354 97.4214C590.348 93.9878 588.345 89.6481 588.345 84.4023C588.345 80.8733 589.204 77.7258 590.92 74.9598C592.637 72.0985 594.974 69.714 597.931 67.8065C600.983 65.8035 604.512 64.2775 608.518 63.2283C612.524 62.1792 616.768 61.6546 621.251 61.6546C622.872 61.6546 624.494 61.7023 626.115 61.7976C627.832 61.7976 629.596 61.893 631.408 62.0838C633.316 62.1792 635.271 62.3699 637.274 62.656L637.56 70.5247C635.844 70.2386 634.079 70.0479 632.267 69.9525C630.55 69.7617 628.833 69.6187 627.116 69.5233C625.4 69.4279 623.73 69.3802 622.109 69.3802C618.675 69.3802 615.528 69.6663 612.667 70.2386C609.805 70.8109 607.326 71.6693 605.227 72.8138C603.129 73.9584 601.507 75.4367 600.363 77.2489C599.218 79.0611 598.646 81.2548 598.646 83.83C598.646 85.8329 598.98 87.5497 599.648 88.9804C600.411 90.3157 601.412 91.4126 602.652 92.271C603.892 93.034 605.323 93.6063 606.944 93.9878C608.661 94.3693 610.521 94.56 612.524 94.56C616.243 94.56 619.534 93.9878 622.395 92.8432C625.352 91.6033 627.832 89.8388 629.835 87.5497C631.933 85.2607 633.507 82.447 634.556 79.1088C635.605 75.7705 636.13 71.9554 636.13 67.6634C636.13 61.1777 635.367 56.1226 633.841 52.4983C632.315 48.8739 630.025 46.2987 626.973 44.7726C624.017 43.2466 620.202 42.4836 615.528 42.4836C612.381 42.4836 609.281 43.1035 606.229 44.3434C603.177 45.488 600.411 47.3002 597.931 49.78L592.923 43.1989C595.975 40.1468 599.504 37.8577 603.51 36.3317C607.516 34.8056 611.761 34.0426 616.243 34.0426C620.535 34.0426 624.446 34.5672 627.975 35.6163C631.504 36.6655 634.508 38.43 636.988 40.9098C639.563 43.2943 641.519 46.5371 642.854 50.6384C644.285 54.7397 645 59.8901 645 66.0897V100.855H633.841V90.8403C632.601 93.2248 631.075 95.18 629.262 96.7061C627.546 98.2321 625.686 99.4243 623.683 100.283C621.68 101.046 619.629 101.57 617.531 101.856C615.433 102.238 613.43 102.429 611.522 102.429Z" fill="white" />
                <path d="M520.102 100.855V35.4732H530.117V47.0616C531.833 44.391 533.836 42.1019 536.125 40.1944C538.414 38.1914 540.942 36.6654 543.708 35.6162C546.474 34.4717 549.335 33.8994 552.292 33.8994C555.916 33.8994 559.159 34.8055 562.021 36.6177C564.882 38.4299 567.171 41.3389 568.888 45.3448C570.605 49.3507 571.463 54.6442 571.463 61.2253V100.855H561.448V61.5114C561.448 56.9332 560.924 53.3089 559.875 50.6383C558.825 47.8723 557.395 45.9171 555.583 44.7725C553.77 43.5326 551.72 42.9127 549.431 42.9127C547.237 42.9127 544.996 43.3895 542.706 44.3433C540.513 45.2971 538.462 46.6801 536.555 48.4923C534.647 50.2091 533.073 52.3074 531.833 54.7872C530.689 57.2671 530.117 60.0807 530.117 63.2282V100.855H520.102Z" fill="white" />
                <path d="M468.455 102.429C461.015 102.429 455.293 100.76 451.287 97.4214C447.281 93.9878 445.278 89.6481 445.278 84.4023C445.278 80.8733 446.136 77.7258 447.853 74.9598C449.57 72.0985 451.907 69.714 454.864 67.8065C457.916 65.8035 461.445 64.2775 465.451 63.2283C469.456 62.1792 473.701 61.6546 478.184 61.6546C479.805 61.6546 481.426 61.7023 483.048 61.7976C484.765 61.7976 486.529 61.893 488.341 62.0838C490.249 62.1792 492.204 62.3699 494.207 62.656L494.493 70.5247C492.776 70.2386 491.012 70.0479 489.2 69.9525C487.483 69.7617 485.766 69.6187 484.049 69.5233C482.333 69.4279 480.663 69.3802 479.042 69.3802C475.608 69.3802 472.461 69.6663 469.6 70.2386C466.738 70.8109 464.258 71.6693 462.16 72.8138C460.062 73.9584 458.44 75.4367 457.296 77.2489C456.151 79.0611 455.579 81.2548 455.579 83.83C455.579 85.8329 455.913 87.5497 456.58 88.9804C457.343 90.3157 458.345 91.4126 459.585 92.271C460.825 93.034 462.255 93.6063 463.877 93.9878C465.594 94.3693 467.454 94.56 469.456 94.56C473.176 94.56 476.467 93.9878 479.328 92.8432C482.285 91.6033 484.765 89.8388 486.768 87.5497C488.866 85.2607 490.44 82.447 491.489 79.1088C492.538 75.7705 493.063 71.9554 493.063 67.6634C493.063 61.1777 492.3 56.1226 490.773 52.4983C489.247 48.8739 486.958 46.2987 483.906 44.7726C480.95 43.2466 477.134 42.4836 472.461 42.4836C469.313 42.4836 466.214 43.1035 463.161 44.3434C460.109 45.488 457.343 47.3002 454.864 49.78L449.856 43.1989C452.908 40.1468 456.437 37.8577 460.443 36.3317C464.449 34.8056 468.693 34.0426 473.176 34.0426C477.468 34.0426 481.379 34.5672 484.908 35.6163C488.437 36.6655 491.441 38.43 493.921 40.9098C496.496 43.2943 498.451 46.5371 499.787 50.6384C501.217 54.7397 501.933 59.8901 501.933 66.0897V100.855H490.773V90.8403C489.534 93.2248 488.007 95.18 486.195 96.7061C484.479 98.2321 482.619 99.4243 480.616 100.283C478.613 101.046 476.562 101.57 474.464 101.856C472.365 102.238 470.363 102.429 468.455 102.429Z" fill="white" />
                <path d="M383.759 35.4732H394.489L394.06 54.5011L392.773 52.3551C393.345 49.3984 394.346 46.7755 395.777 44.4864C397.208 42.1973 398.924 40.2898 400.927 38.7637C402.93 37.1423 405.124 35.95 407.508 35.187C409.893 34.3286 412.373 33.8994 414.948 33.8994C418.382 33.8994 421.529 34.5194 424.39 35.7593C427.347 36.9038 429.97 38.6683 432.259 41.0528L427.681 49.0645L427.109 50.3521L426.107 49.7799C425.916 49.0169 425.63 48.3015 425.249 47.6339C424.867 46.9662 424.057 46.1555 422.817 45.2017C421.291 44.2479 419.86 43.628 418.525 43.3419C417.285 42.9603 415.854 42.7696 414.233 42.7696C411.848 42.7696 409.464 43.2465 407.079 44.2003C404.695 45.0587 402.501 46.4416 400.498 48.3492C398.591 50.2568 397.065 52.6889 395.92 55.6456C394.775 58.6024 394.203 62.1314 394.203 66.2326V100.998H383.759V35.4732Z" fill="white" />
                <path d="M325.388 102.429C317.948 102.429 312.225 100.76 308.22 97.4214C304.214 93.9878 302.211 89.6481 302.211 84.4023C302.211 80.8733 303.069 77.7258 304.786 74.9598C306.503 72.0985 308.839 69.714 311.796 67.8065C314.848 65.8035 318.377 64.2775 322.383 63.2283C326.389 62.1792 330.633 61.6546 335.116 61.6546C336.738 61.6546 338.359 61.7023 339.98 61.7976C341.697 61.7976 343.462 61.893 345.274 62.0838C347.181 62.1792 349.137 62.3699 351.14 62.656L351.426 70.5247C349.709 70.2386 347.945 70.0479 346.132 69.9525C344.416 69.7617 342.699 69.6187 340.982 69.5233C339.265 69.4279 337.596 69.3802 335.975 69.3802C332.541 69.3802 329.393 69.6663 326.532 70.2386C323.671 70.8109 321.191 71.6693 319.093 72.8138C316.994 73.9584 315.373 75.4367 314.228 77.2489C313.084 79.0611 312.512 81.2548 312.512 83.83C312.512 85.8329 312.845 87.5497 313.513 88.9804C314.276 90.3157 315.278 91.4126 316.517 92.271C317.757 93.034 319.188 93.6063 320.809 93.9878C322.526 94.3693 324.386 94.56 326.389 94.56C330.109 94.56 333.399 93.9878 336.261 92.8432C339.217 91.6033 341.697 89.8388 343.7 87.5497C345.799 85.2607 347.372 82.447 348.421 79.1088C349.471 75.7705 349.995 71.9554 349.995 67.6634C349.995 61.1777 349.232 56.1226 347.706 52.4983C346.18 48.8739 343.891 46.2987 340.839 44.7726C337.882 43.2466 334.067 42.4836 329.393 42.4836C326.246 42.4836 323.146 43.1035 320.094 44.3434C317.042 45.488 314.276 47.3002 311.796 49.78L306.789 43.1989C309.841 40.1468 313.37 37.8577 317.376 36.3317C321.382 34.8056 325.626 34.0426 330.109 34.0426C334.401 34.0426 338.311 34.5672 341.84 35.6163C345.369 36.6655 348.374 38.43 350.854 40.9098C353.429 43.2943 355.384 46.5371 356.719 50.6384C358.15 54.7397 358.865 59.8901 358.865 66.0897V100.855H347.706V90.8403C346.466 93.2248 344.94 95.18 343.128 96.7061C341.411 98.2321 339.551 99.4243 337.548 100.283C335.545 101.046 333.495 101.57 331.396 101.856C329.298 102.238 327.295 102.429 325.388 102.429Z" fill="white" />
                <path d="M233.968 100.855V35.4732H243.982V47.0616C245.699 44.391 247.702 42.1019 249.991 40.1944C252.28 38.1914 254.808 36.6654 257.574 35.6162C260.34 34.4717 263.201 33.8994 266.158 33.8994C269.782 33.8994 273.025 34.8055 275.886 36.6177C278.748 38.4299 281.037 41.3389 282.753 45.3448C284.47 49.3507 285.329 54.6442 285.329 61.2253V100.855H275.314V61.5114C275.314 56.9332 274.789 53.3089 273.74 50.6383C272.691 47.8723 271.26 45.9171 269.448 44.7725C267.636 43.5326 265.585 42.9127 263.296 42.9127C261.103 42.9127 258.861 43.3895 256.572 44.3433C254.378 45.2971 252.328 46.6801 250.42 48.4923C248.513 50.2091 246.939 52.3074 245.699 54.7872C244.554 57.2671 243.982 60.0807 243.982 63.2282V100.855H233.968Z" fill="white" />
                <path d="M182.32 102.429C174.881 102.429 169.158 100.76 165.152 97.4214C161.146 93.9878 159.144 89.6481 159.144 84.4023C159.144 80.8733 160.002 77.7258 161.719 74.9598C163.436 72.0985 165.772 69.714 168.729 67.8065C171.781 65.8035 175.31 64.2775 179.316 63.2283C183.322 62.1792 187.566 61.6546 192.049 61.6546C193.67 61.6546 195.292 61.7023 196.913 61.7976C198.63 61.7976 200.395 61.893 202.207 62.0838C204.114 62.1792 206.07 62.3699 208.073 62.656L208.359 70.5247C206.642 70.2386 204.877 70.0479 203.065 69.9525C201.348 69.7617 199.632 69.6187 197.915 69.5233C196.198 69.4279 194.529 69.3802 192.907 69.3802C189.474 69.3802 186.326 69.6663 183.465 70.2386C180.604 70.8109 178.124 71.6693 176.025 72.8138C173.927 73.9584 172.306 75.4367 171.161 77.2489C170.017 79.0611 169.444 81.2548 169.444 83.83C169.444 85.8329 169.778 87.5497 170.446 88.9804C171.209 90.3157 172.21 91.4126 173.45 92.271C174.69 93.034 176.121 93.6063 177.742 93.9878C179.459 94.3693 181.319 94.56 183.322 94.56C187.042 94.56 190.332 93.9878 193.194 92.8432C196.15 91.6033 198.63 89.8388 200.633 87.5497C202.731 85.2607 204.305 82.447 205.354 79.1088C206.403 75.7705 206.928 71.9554 206.928 67.6634C206.928 61.1777 206.165 56.1226 204.639 52.4983C203.113 48.8739 200.824 46.2987 197.772 44.7726C194.815 43.2466 191 42.4836 186.326 42.4836C183.179 42.4836 180.079 43.1035 177.027 44.3434C173.975 45.488 171.209 47.3002 168.729 49.78L163.722 43.1989C166.774 40.1468 170.303 37.8577 174.309 36.3317C178.315 34.8056 182.559 34.0426 187.042 34.0426C191.334 34.0426 195.244 34.5672 198.773 35.6163C202.302 36.6655 205.307 38.43 207.786 40.9098C210.362 43.2943 212.317 46.5371 213.652 50.6384C215.083 54.7397 215.798 59.8901 215.798 66.0897V100.855H204.639V90.8403C203.399 93.2248 201.873 95.18 200.061 96.7061C198.344 98.2321 196.484 99.4243 194.481 100.283C192.478 101.046 190.428 101.57 188.329 101.856C186.231 102.238 184.228 102.429 182.32 102.429Z" fill="white" />
            </g>
            <g id="txts-fe" filter="url(#filter1_d_13_2)">
                <path d="M10 101V11.8687H65.2329V24.8879H24.3776V46.4912H57.5459V59.5103H24.3776V101H10Z" fill="#0077B6" />
                <path d="M83.7388 101V88.267H99.9671V47.2065H84.5929V34.4735H116.195V88.267H131V101H83.7388ZM107.369 23.4572C104.617 23.4572 102.245 22.5034 100.252 20.5959C98.2588 18.6883 97.2624 16.3992 97.2624 13.7286C97.2624 10.8673 98.2114 8.53048 100.109 6.71829C102.007 4.9061 104.427 4 107.369 4C110.027 4 112.352 4.95378 114.345 6.86135C116.433 8.76893 117.476 11.058 117.476 13.7286C117.476 16.3992 116.433 18.6883 114.345 20.5959C112.352 22.5034 110.027 23.4572 107.369 23.4572Z" fill="#0077B6" />
                <path d="M8 101V103H10H24.3776H26.3776V101V61.5103H57.5459H59.5459V59.5103V46.4912V44.4912H57.5459H26.3776V26.8879H65.2329H67.2329V24.8879V11.8687V9.86873H65.2329H10H8V11.8687V101ZM81.7388 101V103H83.7388H131H133V101V88.267V86.267H131H118.195V34.4735V32.4735H116.195H84.5929H82.5929V34.4735V47.2065V49.2065H84.5929H97.9671V86.267H83.7388H81.7388V88.267V101ZM98.8688 22.0407C101.233 24.3036 104.101 25.4572 107.369 25.4572C110.556 25.4572 113.365 24.295 115.711 22.0567C118.175 19.7981 119.476 16.9897 119.476 13.7286C119.476 10.4676 118.175 7.6592 115.711 5.40057C113.365 3.16222 110.556 2 107.369 2C103.981 2 101.045 3.06024 98.7283 5.27174C96.397 7.49755 95.2624 10.3756 95.2624 13.7286C95.2624 16.9648 96.4964 19.7699 98.8688 22.0407Z" stroke="white" strokeWidth="4" />
            </g>

            <defs>
                <filter id="filter0_d_13_2" x="153.144" y="33.8994" width="497.856" height="80.5293" filterUnits="userSpaceOnUse" colorInterpolationFilters="sRGB">
                    <feFlood floodOpacity="0" result="BackgroundImageFix" />
                    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
                    <feOffset className="fe-offset" dy="0" />
                    <feGaussianBlur stdDeviation="3" />
                    <feComposite in2="hardAlpha" operator="out" />
                    <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.5 0" />
                    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_13_2" />
                    <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_13_2" result="shape" />
                </filter>
                <filter id="filter1_d_13_2" x="0" y="0" width="141" height="117" filterUnits="userSpaceOnUse" colorInterpolationFilters="sRGB">
                    <feFlood floodOpacity="0" result="BackgroundImageFix" />
                    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
                    <feOffset className="fe-offset" dy="0" />
                    <feGaussianBlur stdDeviation="3" />
                    <feComposite in2="hardAlpha" operator="out" />
                    <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.5 0" />
                    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_13_2" />
                    <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_13_2" result="shape" />
                </filter>
            </defs>
        </svg>
    </main>
}